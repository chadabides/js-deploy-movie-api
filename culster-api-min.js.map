{"version":3,"sources":["webpack:///culster-api-min.js","webpack:///webpack/bootstrap f9ab1b62c21fe7eae2bc","webpack:///./buildScripts/cluster.js","webpack:///external \"cluster\"","webpack:///external \"os\"","webpack:///./src/server/apiServer.js","webpack:///external \"babel-polyfill\"","webpack:///external \"express\"","webpack:///external \"path\"","webpack:///external \"compression\"","webpack:///external \"cors\"","webpack:///external \"cookie-parser\"","webpack:///external \"body-parser\"","webpack:///external \"method-override\"","webpack:///external \"mongoose\"","webpack:///./src/server/routes/movie.js","webpack:///./src/server/api/movies.js","webpack:///./src/server/data/db.js","webpack:///./src/server/core/logger.js","webpack:///external \"fs\"","webpack:///external \"rotating-file-stream\"","webpack:///external \"morgan\"","webpack:///external \"winston\"","webpack:///external \"moment\"","webpack:///external \"mongodb\""],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","cluster","os","isMaster","cpus","length","console","log","i","fork","on","worker","code","exitedAfterDisconnect","require","_interopRequireDefault","obj","__esModule","default","_express","_express2","_path","_compression","_compression2","_cors","_cors2","_cookieParser","_bodyParser","_bodyParser2","_methodOverride","_methodOverride2","_mongoose","_movie","_movie2","_logger","_logger2","_db","_db2","logger","cfg","consoleLevel","fileLevel","pid","process","app","use","env","NODE_ENV","connect","then","error","urlencoded","extended","json","dev","req","res","send","err","next","port","PORT","get","request","response","result","listen","Object","defineProperty","value","_movies","_movies2","router","Router","movieService","post","save","put","getbyId","remove","_classCallCheck","instance","Constructor","TypeError","_mongodb","_mongodb2","MovieService","this","getMovieCollection","db","collection","find","toArray","movies","movie","body","_id","ObjectID","trim","movieId","params","sendStatus","getMoviebyId","findOne","JSON","stringify","service","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","connectionString","Database","_this","dbconnection","arguments","undefined","MongoClient","__dirname","_fs","_fs2","_path2","_rotatingFileStream","_rotatingFileStream2","_morgan","_morgan2","_winston","_winston2","_moment","_moment2","s_logger","Symbol","defaultcfg","loggerService","_timeStamp","time","format","token","logDirectory","join","existsSync","mkdirSync","accessLogStream","interval","path","Logger","transports","File","level","filename","handleExceptions","maxsize","maxFiles","colorize","timestamp","prettyprint","Console","exitOnError","updateConfig","file","timeStamp","message","category","stream"],"mappings":"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","file":"culster-api-min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar cluster = __webpack_require__(1);\n\tvar os = __webpack_require__(2);\n\tif (cluster.isMaster) {\n\t  var cpus = os.cpus().length;\n\t  console.log('Forking for ' + cpus + ' CPUs');\n\t  for (var i = 0; i < cpus; i++) {\n\t    cluster.fork();\n\t  }\n\t  //(worker,code,signal)\n\t  cluster.on('exit', function (worker, code) {\n\t    if (code != worker.exitedAfterDisconnect) {\n\t      console.log('Worker ' + worker.id + ' crashed' + 'Starting new worker...');\n\t      cluster.fork();\n\t    }\n\t  });\n\t} else {\n\t  __webpack_require__(3);\n\t}\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"cluster\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"os\");\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\t__webpack_require__(4);\n\t\n\tvar _express = __webpack_require__(5);\n\t\n\tvar _express2 = _interopRequireDefault(_express);\n\t\n\tvar _path = __webpack_require__(6);\n\t\n\tvar _path2 = _interopRequireDefault(_path);\n\t\n\tvar _compression = __webpack_require__(7);\n\t\n\tvar _compression2 = _interopRequireDefault(_compression);\n\t\n\tvar _cors = __webpack_require__(8);\n\t\n\tvar _cors2 = _interopRequireDefault(_cors);\n\t\n\tvar _cookieParser = __webpack_require__(9);\n\t\n\tvar _cookieParser2 = _interopRequireDefault(_cookieParser);\n\t\n\tvar _bodyParser = __webpack_require__(10);\n\t\n\tvar _bodyParser2 = _interopRequireDefault(_bodyParser);\n\t\n\tvar _methodOverride = __webpack_require__(11);\n\t\n\tvar _methodOverride2 = _interopRequireDefault(_methodOverride);\n\t\n\tvar _mongoose = __webpack_require__(12);\n\t\n\tvar _mongoose2 = _interopRequireDefault(_mongoose);\n\t\n\tvar _movie = __webpack_require__(13);\n\t\n\tvar _movie2 = _interopRequireDefault(_movie);\n\t\n\tvar _logger = __webpack_require__(16);\n\t\n\tvar _logger2 = _interopRequireDefault(_logger);\n\t\n\tvar _db = __webpack_require__(15);\n\t\n\tvar _db2 = _interopRequireDefault(_db);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t//Add logger info\n\t\n\t//import other libs\n\tvar logger = new _logger2.default();\n\t// sets config options on winston\n\t/* eslint-disable no-unused-vars */\n\tlogger.cfg({ consoleLevel: 'debug', fileLevel: 'error' });\n\t// Import Database Connection here\n\t\n\tvar pid = process.pid;\n\t\n\tvar app = (0, _express2.default)();\n\tapp.use('/favicon.ico', _express2.default.static('./src/server/public/favicon.ico'));\n\tapp.use((0, _compression2.default)());\n\tapp.use((0, _cors2.default)());\n\t\n\tprocess.env.NODE_ENV = 'production';\n\t\n\t/** Database Connections go Here */\n\t_db2.default.connect().then(function () {\n\t  logger.log('Database is connected using the worker is ' + pid, 'info');\n\t}).catch(function (error) {\n\t  logger.log(error, 'error');\n\t});\n\t\n\tapp.use(_bodyParser2.default.urlencoded({\n\t  extended: true\n\t}));\n\tapp.use(_bodyParser2.default.json());\n\t\n\tapp.use((0, _methodOverride2.default)());\n\t\n\tapp.use(logger.dev);\n\t\n\t/** Mount Api's Here */\n\tapp.use('/admin', function (req, res) {\n\t  res.send('Api Server is loaded for admin using worker-id: ' + pid);\n\t});\n\t\n\t/** Mount Routes Here */\n\t\n\t//mount movie store module here\n\tapp.use('/movies', _movie2.default);\n\t\n\t// production error handler will log errors\n\tapp.use(function (err, req, res, next) {\n\t  logger.log(err, 'error');\n\t});\n\tvar port = process.env.PORT || 5000;\n\tapp.get('/', function (request, response) {\n\t  var result = 'App is running';\n\t  response.send(result);\n\t}).listen(port, function (err) {\n\t  logger.log('api started on port ' + port, 'info');\n\t  if (err) {\n\t    logger.log(err);\n\t  }\n\t});\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"babel-polyfill\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"express\");\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"path\");\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"compression\");\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"cors\");\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"cookie-parser\");\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"body-parser\");\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"method-override\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"mongoose\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _express = __webpack_require__(5);\n\t\n\tvar _express2 = _interopRequireDefault(_express);\n\t\n\tvar _movies = __webpack_require__(14);\n\t\n\tvar _movies2 = _interopRequireDefault(_movies);\n\t\n\tvar _logger = __webpack_require__(16);\n\t\n\tvar _logger2 = _interopRequireDefault(_logger);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar router = _express2.default.Router(); /* eslint-disable no-unused-vars */\n\t/* eslint-disable no-case-declarations */\n\t/** Restful Movie API routes */\n\t\n\tvar movieService = new _movies2.default();\n\tvar logger = new _logger2.default();\n\t\n\t// GET MOVIES\n\trouter.get('/', movieService.get);\n\t\n\t// ADD\n\trouter.post('/', movieService.save);\n\t\n\t//EDIT MOVIE\n\trouter.put('/', movieService.save);\n\t\n\t//get movie details\n\trouter.get('/:id', movieService.getbyId);\n\t\n\t// DELETE MOVIE\n\trouter.delete('/:id', movieService.remove);\n\t\n\texports.default = router;\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _db = __webpack_require__(15);\n\t\n\tvar _db2 = _interopRequireDefault(_db);\n\t\n\tvar _logger = __webpack_require__(16);\n\t\n\tvar _logger2 = _interopRequireDefault(_logger);\n\t\n\tvar _mongodb = __webpack_require__(22);\n\t\n\tvar _mongodb2 = _interopRequireDefault(_mongodb);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar logger = new _logger2.default();\n\t\n\tvar MovieService = function MovieService() {\n\t  _classCallCheck(this, MovieService);\n\t\n\t  logger.log('Starting Movie AP', 'debug');\n\t  // ADD OR EDIT MOVIE\n\t\n\t\n\t  // GET MOVIES\n\t  var getMovieCollection = function getMovieCollection(req, res, next) {\n\t    _db2.default.db.collection('movies').find().toArray().then(function (movies) {\n\t      res.json(movies);\n\t    }).catch(function (error) {\n\t      logger.log('Mongo has a problem: ' + error, 'debug');\n\t      next(error);\n\t    });\n\t  };\n\t\n\t  var save = function save(req, res, next) {\n\t    var movie = req.body;\n\t    if (movie._id) movie._id = new _mongodb2.default.ObjectID(movie._id.trim());\n\t    _db2.default.db.collection('movies').save(req.body).then(function (result) {\n\t      if (result === null) {\n\t        logger.log('Errror on Save adding Movie to the database', 'debug');\n\t        next('Result was null');\n\t      } else {\n\t        res.json(result);\n\t      }\n\t    }).catch(function (error) {\n\t      logger.log('Mongo has a problem: ' + error, 'debug');\n\t      next(error);\n\t    });\n\t  };\n\t\n\t  // DELETE MOVIE\n\t  var remove = function remove(req, res, next) {\n\t    var movieId = new _mongodb2.default.ObjectID(req.params['id'].trim());\n\t    _db2.default.db.collection('movies').remove({ _id: movieId }).then(function () {\n\t      res.sendStatus(200);\n\t    }).catch(function (error) {\n\t      logger.log('Mongo has a problem: ' + error, 'debug');\n\t      next(error);\n\t    });\n\t  };\n\t  var getMoviebyId = function getMoviebyId(req, res, next) {\n\t    var movieId = new _mongodb2.default.ObjectID(req.params['id']);\n\t    _db2.default.db.collection('movies').findOne(movieId).then(function (result) {\n\t      logger.log('the movie is ' + JSON.stringify(result), 'debug');\n\t      if (result === null) {\n\t        logger.log('No record Found', 'debug');\n\t        next('Result was null');\n\t      } else {\n\t        res.json(result);\n\t      }\n\t    }).catch(function (error) {\n\t      logger.log('Mongo has a problem: ' + error, 'debug');\n\t      next(error);\n\t    });\n\t  };\n\t  var service = {\n\t    get: getMovieCollection,\n\t    getbyId: getMoviebyId,\n\t    save: save,\n\t    remove: remove\n\t  };\n\t  //return service\n\t  return service;\n\t};\n\t\n\texports.default = MovieService;\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /** This file is where tjhe backend database goes  */\n\t\n\t\n\tvar _logger = __webpack_require__(16);\n\t\n\tvar _logger2 = _interopRequireDefault(_logger);\n\t\n\tvar _mongodb = __webpack_require__(22);\n\t\n\tvar _mongodb2 = _interopRequireDefault(_mongodb);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar logger = new _logger2.default();\n\tvar connectionString = '';\n\t\n\tvar Database = function () {\n\t    function Database() {\n\t        _classCallCheck(this, Database);\n\t    }\n\t\n\t    _createClass(Database, null, [{\n\t        key: 'connect',\n\t        value: function connect() {\n\t            var _this = this;\n\t\n\t            var dbconnection = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'mongodb://api:!AgileRules4#@ds062059.mlab.com:62059/mic-pro';\n\t\n\t            connectionString = dbconnection;\n\t            return _mongodb2.default.MongoClient.connect(connectionString).then(function (db) {\n\t                logger.log('successful db connection', 'info'); /* eslint-disable no-console */\n\t                _this.db = db;\n\t            }).catch(function (err) {\n\t                logger.error(err, 'error');\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return Database;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = Database;\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(__dirname) {'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _fs = __webpack_require__(17);\n\t\n\tvar _fs2 = _interopRequireDefault(_fs);\n\t\n\tvar _path = __webpack_require__(6);\n\t\n\tvar _path2 = _interopRequireDefault(_path);\n\t\n\tvar _rotatingFileStream = __webpack_require__(18);\n\t\n\tvar _rotatingFileStream2 = _interopRequireDefault(_rotatingFileStream);\n\t\n\tvar _morgan = __webpack_require__(19);\n\t\n\tvar _morgan2 = _interopRequireDefault(_morgan);\n\t\n\tvar _winston = __webpack_require__(20);\n\t\n\tvar _winston2 = _interopRequireDefault(_winston);\n\t\n\tvar _moment = __webpack_require__(21);\n\t\n\tvar _moment2 = _interopRequireDefault(_moment);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar s_logger = Symbol('winston');\n\tvar instance = null;\n\t//If cfg is not set then these values will be used\n\t//you can add other options if you would like to expand what can be configured\n\t//@todo add a way to email error logs and custom log type\n\tvar defaultcfg = {\n\t    consoleLevel: 'info',\n\t    fileLevel: 'error'\n\t};\n\t//module service with singleton pattern\n\t\n\tvar loggerService = function () {\n\t    _createClass(loggerService, [{\n\t        key: 'timeStamp',\n\t        get: function get() {\n\t            return this._timeStamp;\n\t        }\n\t        /** @cfg = {consoleLevel: 'info', fileLevel = 'error'}\r\n\t           pass in a config object to change the level of the server only set this once in the system\r\n\t           It will apply to all loggers on the entire server the last one in wins here */\n\t\n\t    }]);\n\t\n\t    function loggerService() {\n\t        var _this = this;\n\t\n\t        _classCallCheck(this, loggerService);\n\t\n\t        if (!instance) {\n\t\n\t            //Setup Logger\n\t            // to test whether we have singleton or not\n\t            this._timeStamp = this.time;\n\t            var time = function time() {\n\t                return (0, _moment2.default)().format('YYYY-MM-DD h:mm:ss a');\n\t            };\n\t\n\t            //set up custom token for req:id and log with Morgan\n\t            _morgan2.default.token('id', function getId(req) {\n\t                return req.id;\n\t            });\n\t            //Make Morgan Write to a file\n\t            var logDirectory = _path2.default.join(__dirname, 'log');\n\t\n\t            // ensure log directory exists\n\t            _fs2.default.existsSync(logDirectory) || _fs2.default.mkdirSync(logDirectory);\n\t\n\t            // create a rotating write stream this keep our log files from getting to big\n\t            var accessLogStream = (0, _rotatingFileStream2.default)('request.log', {\n\t                interval: '1d', // rotate daily\n\t                path: logDirectory\n\t            });\n\t\n\t            //set up winston\n\t            /** @todo: remove config options if they are being Set\r\n\t                using the defaultcfg let updateConfig handle this. */\n\t            this[s_logger] = new _winston2.default.Logger({\n\t                transports: [new _winston2.default.transports.File({\n\t                    level: defaultcfg.fileLevel,\n\t                    filename: 'app.log',\n\t                    handleExceptions: true,\n\t                    json: true,\n\t                    maxsize: 5242880, //5MB\n\t                    maxFiles: 5,\n\t                    colorize: false,\n\t                    timestamp: true,\n\t                    prettyprint: true\n\t                }), new _winston2.default.transports.Console({\n\t                    level: defaultcfg.consoleLevel,\n\t                    handleExceptions: true,\n\t                    json: false,\n\t                    colorize: true\n\t                })],\n\t                exitOnError: false\n\t            });\n\t            /** @todo change this to loop through cfg properties and only assign if properties match  */\n\t            var updateConfig = function updateConfig(cfg) {\n\t                defaultcfg = cfg;\n\t                _this[s_logger].transports.console.level = cfg.consoleLevel;\n\t                _this[s_logger].transports.file.level = cfg.fileLevel;\n\t            };\n\t\n\t            var logger = {\n\t                timeStamp: this._timeStamp,\n\t                time: time,\n\t                log: function log(message) {\n\t                    var category = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'info';\n\t                    _this[s_logger].log(category, message);\n\t                },\n\t                cfg: updateConfig,\n\t                dev: (0, _morgan2.default)(':id :method :status :url :response-time[3]', { stream: accessLogStream })\n\t            };\n\t\n\t            instance = logger;\n\t        }\n\t\n\t        return instance;\n\t    }\n\t\n\t    return loggerService;\n\t}();\n\t\n\texports.default = loggerService;\n\t/* WEBPACK VAR INJECTION */}.call(exports, \"/\"))\n\n/***/ },\n/* 17 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"fs\");\n\n/***/ },\n/* 18 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"rotating-file-stream\");\n\n/***/ },\n/* 19 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"morgan\");\n\n/***/ },\n/* 20 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"winston\");\n\n/***/ },\n/* 21 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"moment\");\n\n/***/ },\n/* 22 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"mongodb\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** culster-api-min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap f9ab1b62c21fe7eae2bc\n **/","const cluster = require('cluster');\nconst os = require('os');\nif (cluster.isMaster){\n  const cpus = os.cpus().length;\n  console.log(`Forking for ${cpus} CPUs`)\n  for(let i = 0; i<cpus; i++){\n    cluster.fork();\n  }\n  //(worker,code,signal)\n  cluster.on('exit',(worker,code)=>{\n    if(code!= worker.exitedAfterDisconnect){\n        console.log(`Worker ${worker.id} crashed` +\n                    `Starting new worker...`);\n        cluster.fork();\n    }\n  })\n}\nelse {\n  require('../src/server/apiServer')\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./buildScripts/cluster.js\n **/","module.exports = require(\"cluster\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cluster\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"os\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"os\"\n ** module id = 2\n ** module chunks = 0\n **/","/* eslint-disable no-unused-vars */\r\nimport 'babel-polyfill';\r\nimport express from 'express';\r\nimport path from 'path';\r\nimport compression from 'compression';\r\nimport cors from 'cors';\r\nimport cookieParser from 'cookie-parser';\r\nimport bodyParser from 'body-parser';\r\nimport methodOverride from 'method-override';\r\nimport mongoose from 'mongoose';\r\n//import other libs\r\nimport moviesRoute from './routes/movie';\nimport {default as log} from './core/logger';\n//Add logger info\r\nlet logger = new log();\r\n// sets config options on winston\r\nlogger.cfg({consoleLevel: 'debug',fileLevel: 'error'});\r\n// Import Database Connection here\r\nimport {default as Database} from  \"./data/db\";\nconst pid = process.pid;\n\r\n\r\nconst app = express();\r\napp.use('/favicon.ico', express.static('./src/server/public/favicon.ico'));\r\napp.use(compression());\r\napp.use(cors());\r\n\r\n\r\nprocess.env.NODE_ENV = 'production';\r\n\r\n/** Database Connections go Here */\r\nDatabase.connect().then(() => {\r\nlogger.log(`Database is connected using the worker is ${pid}`, 'info')\n}).\r\ncatch((error)=>{\r\n  logger.log(error, 'error')\r\n});\r\n\r\n\r\napp.use(bodyParser.urlencoded({\r\n  extended: true\r\n}))\r\napp.use(bodyParser.json())\r\n\r\napp.use(methodOverride())\r\n\r\napp.use(logger.dev);\r\n\r\n/** Mount Api's Here */\r\napp.use('/admin', (req, res) => {\r\n  res.send(`Api Server is loaded for admin using worker-id: ${pid}`);\n});\n\n /** Mount Routes Here */\r\n\r\n//mount movie store module here\r\napp.use('/movies', moviesRoute);\r\n\r\n// production error handler will log errors\r\napp.use(function (err, req, res, next) {\r\n  logger.log(err ,'error');\r\n});\r\nlet port = (process.env.PORT || 5000);\r\napp.get('/', function(request, response) {\r\n    var result = 'App is running'\r\n    response.send(result);\r\n}).listen(port, function(err) {\r\n  logger.log(`api started on port ${port}` ,'info');\r\n  if (err) {\r\n    logger.log(err);\r\n  }\r\n});\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/apiServer.js\n **/","module.exports = require(\"babel-polyfill\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-polyfill\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"compression\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"compression\"\n ** module id = 7\n ** module chunks = 0\n **/","module.exports = require(\"cors\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cors\"\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"cookie-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cookie-parser\"\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 10\n ** module chunks = 0\n **/","module.exports = require(\"method-override\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"method-override\"\n ** module id = 11\n ** module chunks = 0\n **/","module.exports = require(\"mongoose\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongoose\"\n ** module id = 12\n ** module chunks = 0\n **/","/* eslint-disable no-unused-vars */\r\n/* eslint-disable no-case-declarations */\r\n/** Restful Movie API routes */\r\nimport express from 'express';\r\nimport  {default as MovieService}  from '../api/movies';\r\nimport {default as Logger} from '../../server/core/logger';\r\n\r\nlet router = express.Router();\r\nlet movieService = new MovieService();\r\nlet logger = new Logger();\r\n\r\n\r\n// GET MOVIES\r\nrouter.get('/',movieService.get);\r\n\r\n// ADD\r\nrouter.post('/', movieService.save);\r\n\r\n//EDIT MOVIE\r\nrouter.put('/', movieService.save);\r\n\r\n//get movie details\r\nrouter.get('/:id', movieService.getbyId);\r\n\r\n\r\n// DELETE MOVIE\r\nrouter.delete('/:id', movieService.remove);\r\n\r\n\r\n\r\n\r\nexport default router;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/routes/movie.js\n **/","import {default as Database} from  \"../../server/data/db\";\r\nimport {default as Logger} from '../../server/core/logger';\r\nimport mongodb from 'mongodb';\r\nlet logger = new Logger();\r\n\r\nexport default class MovieService\r\n{\r\n  constructor(){\r\n\r\n\r\n  logger.log('Starting Movie AP', 'debug')\r\n// ADD OR EDIT MOVIE\r\n\r\n\r\n// GET MOVIES\r\nlet getMovieCollection = (req, res, next) => {\r\n    Database.db.collection('movies').find().toArray().then((movies) => {\r\n        res.json(movies);\r\n    }).\r\n    catch((error) => {\r\n         logger.log(`Mongo has a problem: ${error}`, 'debug')\r\n           next(error);\r\n    });\r\n};\r\n\r\nlet save = (req, res, next) => {\r\n    let movie = req.body;\r\n    if(movie._id)movie._id = new mongodb.ObjectID(movie._id.trim());\r\n    Database.db.collection('movies').save(req.body).then((result) => {\r\n    if(result === null)\r\n    {\r\n      logger.log(`Errror on Save adding Movie to the database`, 'debug')\r\n      next(`Result was null`);\r\n    }\r\n    else {\r\n        res.json(result);\r\n\r\n    }\r\n    }).\r\n    catch((error) => {\r\n     logger.log(`Mongo has a problem: ${error}`, 'debug')\r\n       next(error);\r\n});\r\n}\r\n\r\n// DELETE MOVIE\r\nlet remove = (req, res, next) => {\r\n    let movieId = new mongodb.ObjectID(req.params['id'].trim());\r\n    Database.db.collection('movies').remove({ _id: movieId }).then(() => {\r\n        res.sendStatus(200);\r\n    }).\r\n      catch((error) => {\r\n     logger.log(`Mongo has a problem: ${error}`, 'debug')\r\n       next(error);\r\n})\r\n};\r\nlet getMoviebyId = (req, res, next) =>\r\n  {\r\n    let movieId = new mongodb.ObjectID(req.params['id']);\r\n    Database.db.collection('movies').findOne(movieId).then((result)=> {\r\n        logger.log(`the movie is ${JSON.stringify(result)}`, 'debug')\r\n        if(result === null)\r\n        {\r\n          logger.log(`No record Found`, 'debug')\r\n          next(`Result was null`);\r\n        }\r\n        else {\r\n          res.json(result);\r\n        }\r\n        }).\r\n         catch((error) => {\r\n         logger.log(`Mongo has a problem: ${error}`, 'debug')\r\n           next(error);\r\n         });\r\n};\r\nlet service = {\r\n    get: getMovieCollection,\r\n    getbyId: getMoviebyId,\r\n    save: save,\r\n    remove: remove\r\n};\r\n//return service\r\nreturn service;\r\n}\r\n\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/api/movies.js\n **/","/** This file is where tjhe backend database goes  */\r\nimport {default as Logger} from '../../server/core/logger'\r\nlet logger = new Logger();\r\nlet connectionString = '';\r\n\r\nimport mongodb from 'mongodb';\r\n\r\nclass Database {\r\n    static connect(dbconnection = 'mongodb://api:!AgileRules4#@ds062059.mlab.com:62059/mic-pro') {\r\n      connectionString = dbconnection;\r\n        return mongodb.MongoClient.connect(connectionString).then((db) => {\r\n            logger.log('successful db connection', 'info');/* eslint-disable no-console */\r\n            this.db = db;\r\n        }).catch((err) => {\r\n            logger.error(err,'error');\r\n        });\r\n    }\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexport default Database;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/data/db.js\n **/","import fs from 'fs';\r\nimport path from 'path';\r\nimport rfs from 'rotating-file-stream';\r\nimport morgan from 'morgan';\r\nimport winston from 'winston';\r\nimport moment from 'moment';\r\nlet s_logger = Symbol('winston');\r\nlet instance = null;\r\n//If cfg is not set then these values will be used\r\n//you can add other options if you would like to expand what can be configured\r\n//@todo add a way to email error logs and custom log type\r\nlet defaultcfg = {\r\n    consoleLevel: 'info',\r\n    fileLevel: 'error'\r\n}\r\n//module service with singleton pattern\r\nexport default class loggerService{\r\n  get timeStamp(){ return this._timeStamp}\r\n   /** @cfg = {consoleLevel: 'info', fileLevel = 'error'}\r\n      pass in a config object to change the level of the server only set this once in the system\r\n      It will apply to all loggers on the entire server the last one in wins here */\r\n  constructor(){\r\n    if (!instance)\r\n    {\r\n\r\n      //Setup Logger\r\n       // to test whether we have singleton or not\r\n      this._timeStamp = this.time;\r\n      let time = ()=>{ return moment().format('YYYY-MM-DD h:mm:ss a')}\r\n\r\n      //set up custom token for req:id and log with Morgan\r\n      morgan.token('id', function getId (req) {\r\n               return req.id\r\n         })\r\n      //Make Morgan Write to a file\r\n      var logDirectory = path.join(__dirname, 'log')\r\n\r\n      // ensure log directory exists\r\n      fs.existsSync(logDirectory) || fs.mkdirSync(logDirectory)\r\n\r\n       // create a rotating write stream this keep our log files from getting to big\r\n       var accessLogStream = rfs('request.log', {\r\n        interval: '1d', // rotate daily\r\n       path: logDirectory\r\n      })\r\n\r\n      //set up winston\r\n      /** @todo: remove config options if they are being Set\r\n          using the defaultcfg let updateConfig handle this. */\r\n      this[s_logger] = new winston.Logger({\r\n          transports: [\r\n              new winston.transports.File({\r\n                  level: defaultcfg.fileLevel,\r\n                  filename: 'app.log',\r\n                  handleExceptions: true,\r\n                  json: true,\r\n                  maxsize: 5242880, //5MB\r\n                  maxFiles: 5,\r\n                  colorize: false,\r\n                  timestamp: true,\r\n                  prettyprint:true\r\n              }),\r\n              new winston.transports.Console({\r\n                  level: defaultcfg.consoleLevel,\r\n                  handleExceptions: true,\r\n                  json: false,\r\n                  colorize: true\r\n              })\r\n          ],\r\n          exitOnError: false\r\n      });\r\n      /** @todo change this to loop through cfg properties and only assign if properties match  */\r\n      let updateConfig= (cfg) =>\r\n      {\r\n        defaultcfg = cfg;\r\n        this[s_logger].transports.console.level = cfg.consoleLevel ;\r\n        this[s_logger].transports.file.level = cfg.fileLevel;\r\n\r\n      }\r\n\r\n\r\n      let logger ={\r\n        timeStamp: this._timeStamp,\r\n        time: time,\r\n        log:(message,category = 'info')=>{ this[s_logger].log(category,message)},\r\n        cfg: updateConfig,\r\n        dev: morgan(':id :method :status :url :response-time[3]',{stream: accessLogStream})\r\n      }\r\n\r\n\r\n      instance = logger;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    return instance;\r\n  }\r\n\r\n\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/core/logger.js\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 17\n ** module chunks = 0\n **/","module.exports = require(\"rotating-file-stream\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"rotating-file-stream\"\n ** module id = 18\n ** module chunks = 0\n **/","module.exports = require(\"morgan\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"morgan\"\n ** module id = 19\n ** module chunks = 0\n **/","module.exports = require(\"winston\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston\"\n ** module id = 20\n ** module chunks = 0\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 21\n ** module chunks = 0\n **/","module.exports = require(\"mongodb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongodb\"\n ** module id = 22\n ** module chunks = 0\n **/"],"sourceRoot":""}